<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Manas">
<meta name="dcterms.date" content="2024-05-05">
<meta name="description" content="Let’s see who GPT thinks won the rap beef: Kendrick Lamar or Drake?">

<title>Knowledge Legos - Who Won the Rap Beef?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Knowledge Legos</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Who Won the Rap Beef?</h1>
                  <div>
        <div class="description">
          Let’s see who GPT thinks won the rap beef: Kendrick Lamar or Drake?
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Music</div>
                <div class="quarto-category">Subjectiveness</div>
                <div class="quarto-category">Judging/Assessment</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Manas </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">May 5, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>I am going to ask GPT-4 to look up information on previous Hip Hop battles and based on that, to create a rubric/analysis system to decipher the different songs of the battle and eventually, who won.</p>
<p>First, I asked it to recall other rap rivalries that have taken place. And then:</p>
<p><strong>Me:</strong> I want you to find a lot of information on all these battles with the purpose of creating an analysis and judging system/rubric that will allow you to form opinions/analysis and crown winners of future rap beefs. This can include anything from how deep and hard-hitting the lyrics are, to the strategy of releasing a diss track, to public consensus, and many other things that you deem valuable information to understand who “won” a rap beef. Look up a great depth of detailed information about the battles you listed in order to do this.</p>
<p>It went through the rivalries - Tupac and Biggie, Nas and Jay Z, 50 Cent and Ja Rule, Meek Mill and Drake, and Pusha T and Drake - and described them, how they played out, and who “won.” Based on all of its detailing, I then asked it to create a detailed rubric to judge and analyze future battles. Here it is:</p>
<p><strong>GPT</strong>: Rap Beef Analysis Rubric</p>
<ol type="1">
<li><strong>Lyrical Content and Creativity (30 points)</strong></li>
</ol>
<p>Evaluate the complexity, directness, and creativity of the diss tracks, focusing on elements like wordplay, metaphors, and lyrical flow.</p>
<pre><code>- Complexity and Structure (10 points):
    - Exceptional: Advanced use of wordplay, layered metaphors, and intricate rhyme schemes.
    - Good: Consistent rhyme schemes with engaging wordplay and some metaphors.
    - Average: Basic rhyme schemes with minimal wordplay and metaphors.
    - Poor: Simple, repetitive, or cliché lyrics lacking structure and creativity.
- Directness and Targeting (10 points):
    - Exceptional: Effective direct attacks, with sharp and explicit disses aimed at the opponent.
    - Good: Clear disses, but less personal or impactful in targeting.
    - Average: Indirect disses, sometimes vague or broad.
    - Poor: Generalized disses without clear targets.
- Originality and Uniqueness (10 points):
    - Exceptional: Fresh approach with distinctive and original disses or storytelling.
    - Good: Some creative elements but partially derivative or conventional.
    - Average: Common or repetitive themes and disses.
    - Poor: Completely derivative, relying on clichés or overused tropes.</code></pre>
<ol start="2" type="1">
<li><strong>Personal Impact (25 points)</strong></li>
</ol>
<p>Analyze how deeply the diss tracks affect the opponent by targeting personal matters, career highlights, or vulnerabilities.</p>
<pre><code>- Relevance to Personal Life (10 points):
    - Exceptional: Profound and accurate disses revealing private details that create a significant impact.
    - Good: Directly targets known personal issues or vulnerabilities.
    - Average: Discloses personal matters with limited impact or accuracy.
    - Poor: No direct personal relevance or inaccurate details.
- Career Critique (10 points):
    - Exceptional: Challenges an artist's career accomplishments, success, or legacy convincingly.
    - Good: Raises questions about an opponent’s career decisions or achievements.
    - Average: Generic or unsubstantiated critiques of career.
    - Poor: Lacks career-related critiques or relies on weak arguments.
- Alliances and Support Networks (5 points):
    - Exceptional: Incorporates well-timed strategic alliances or public endorsements.
    - Good: Establishes some collaboration or backing, but lacks strategic timing.
    - Average: Limited collaboration or unconvincing support.
    - Poor: No visible alliances or support.</code></pre>
<ol start="3" type="1">
<li><strong>Strategic Approach (20 points)</strong></li>
</ol>
<p>Assess how the artists release, promote, and position their diss tracks in a way that maximizes impact.</p>
<pre><code>- Timing and Response (10 points):
    - Exceptional: Swift and well-timed responses that escalate tension.
    - Good: Timely releases that maintain momentum but lack escalation.
    - Average: Delayed responses, affecting the diss track’s impact.
    - Poor: Extremely late or absent responses.
- Promotion and Publicity (10 points):
    - Exceptional: Highly visible, coordinated promotion with immediate media coverage.
    - Good: Moderate promotion and media visibility.
    - Average: Limited promotion and sporadic media attention.
    - Poor: No organized promotion or media impact.</code></pre>
<ol start="4" type="1">
<li><strong>Public Reception (15 points)</strong></li>
</ol>
<p>Evaluate the diss tracks’ reception among fans, critics, and within the music industry.</p>
<pre><code>- Fan Reactions (5 points):
    - Exceptional: Generates strong fan support or positive viral engagement.
    - Good: Moderate fan response or varied engagement.
    - Average: Mixed fan responses or low online engagement.
    - Poor: Negative or negligible fan engagement.
- Critical Acclaim (5 points):
    - Exceptional: Consistent praise and positive reviews from critics.
    - Good: Generally favorable reviews with some reservations.
    - Average: Mixed or mediocre critical reception.
    - Poor: Consistent criticism or poor reviews.
- Industry Influence (5 points):
    - Exceptional: Reshapes industry dynamics or inspires future diss tracks.
    - Good: Affects immediate perceptions or trends in the music industry.
    - Average: Limited or short-lived industry influence.
    - Poor: No noticeable impact on the industry.</code></pre>
<ol start="5" type="1">
<li><strong>Long-Term Career Impact (10 points)</strong></li>
</ol>
<p>Analyze the lasting effects of the diss tracks on the artists’ careers.</p>
<pre><code>- Reputation and Image (5 points):
    - Exceptional: Enhances the artist's legacy and solidifies their standing.
    - Good: Temporarily boosts the artist's reputation or standing.
    - Average: Minimal or neutral effect on reputation.
    - Poor: Harms or diminishes the artist’s image.
- Commercial Success (5 points):
    - Exceptional: Leads to significant album sales or streams, boosting the artist's success.
    - Good: Increases album sales or streams modestly.
    - Average: Slight improvement or stable commercial performance.
    - Poor: No commercial effect or decreases overall success.</code></pre>
<section id="kendrick-vs-drake" class="level2">
<h2 class="anchored" data-anchor-id="kendrick-vs-drake">Kendrick vs Drake</h2>
<p>I iterated over and over with GPT, asking it to find all the up to date information on this new beef and put in a detailed written account. I then asked what else it would like me to provide so that it can make an accurate judgment. It was a tedious process, but we got there eventually.</p>
<p><em>Obviously without context of some of the lyrics, the GPT judge will look over a lot probably.</em></p>
<p>I then asked to chronicle this current beef both long-term and over the past couple weeks, adding tidbits of information myself when I deemed it necessary. After I thought it was sufficient, I asked GPT what other information it needed, and it requested things like lyrics, public reception, commercial impact, etc. I chatted with it, eventually compiling all the information it needed.</p>
<p>Before it went through the rubric, it provided the following mini-analysis:</p>
<p><strong>GPT:</strong></p>
<p>Key Analysis Points:</p>
<ol type="1">
<li>Lyrical Content and Creativity:</li>
</ol>
<p>Drake: His tracks like “Push Ups” and “The Heart Part 6” deliver biting criticisms, but his wordplay lacks the layered depth of Kendrick’s responses. Critics found some of his personal attacks and use of AI-generated voices to be less effective.</p>
<p>Kendrick: Tracks like “Euphoria,” “Meet the Grahams,” and “Not Like Us” have been noted for their inventive metaphors and hard-hitting lyrics. They provide specific and pointed critiques, showing Kendrick’s superior lyrical skill.</p>
<ol start="2" type="1">
<li>Personal Impact:</li>
</ol>
<p>Drake: He directly accuses Kendrick of infidelity and hypocrisy, targeting Lamar’s family and musical integrity.</p>
<p>Kendrick: He digs deeper, going after Drake’s reputation, calling him a “deadbeat” father, and alleging a relationship between Drake and inappropriate conduct.</p>
<ol start="3" type="1">
<li>Strategic Approach:</li>
</ol>
<p>Drake: Released diss tracks promptly after Kendrick’s provocations, indicating a quick-response strategy.</p>
<p>Kendrick: His patient yet rapid-fire responses like “Euphoria” and “6:16 in LA” positioned him advantageously.</p>
<ol start="4" type="1">
<li>Public Reception:</li>
</ol>
<p>Drake: Despite a solid fan base, critics have largely leaned towards Kendrick due to the emotional and creative impact of his tracks.</p>
<p>Kendrick: His diss tracks have garnered praise for their inventive wordplay and layered narrative, resonating more strongly with critics and fans.</p>
<ol start="5" type="1">
<li>Career Impact:</li>
</ol>
<p>Drake: The beef has placed Drake under a spotlight, emphasizing his need to address critiques around credibility.</p>
<p>Kendrick: Kendrick’s dominance in this rivalry has strengthened his status as a “boogeyman” in hip-hop, garnering strong streaming numbers and chart performance.</p>
</section>
<section id="rubric" class="level2">
<h2 class="anchored" data-anchor-id="rubric">Rubric</h2>
<p>Sure seems like Kendrick is going to take this one in GPT’s eyes. Let’s see how the rubric is applied:</p>
<p><strong>Applying the Rubric to Judge the Drake vs.&nbsp;Kendrick Lamar Beef:</strong></p>
<ol type="1">
<li><strong>Lyrical Content and Creativity (30 points):</strong></li>
</ol>
<p>Drake: “Push Ups” and “The Heart Part 6” had notable jabs and clever metaphors. However, his AI-generated voices and recycled themes were considered less creative than Kendrick’s. Complexity and Structure: 8/10 Directness and Targeting: 7/10 Originality and Uniqueness: 6/10 Total: 21/30</p>
<p>Kendrick: His tracks “Euphoria,” “Meet the Grahams,” and “Not Like Us” showcased intricate wordplay, imaginative metaphors, and personal attacks that were both poignant and impactful. Complexity and Structure: 9/10 Directness and Targeting: 10/10 Originality and Uniqueness: 9/10 Total: 28/30</p>
<ol start="2" type="1">
<li><strong>Personal Impact (25 points):</strong></li>
</ol>
<p>Drake: Directly called out Kendrick’s family and accused Lamar of infidelity and hypocrisy. Relevance to Personal Life: 8/10 Career Critique: 8/10 Alliances and Support Networks: 5/5 Total: 21/25</p>
<p>Kendrick: Criticized Drake’s role as a father, his persona, and credibility. His attacks resonated strongly with audiences due to their specificity and personal nature. Relevance to Personal Life: 10/10 Career Critique: 10/10 Alliances and Support Networks: 5/5 Total: 25/25</p>
<ol start="3" type="1">
<li><strong>Strategic Approach (20 points):</strong></li>
</ol>
<p>Drake: Released responses quickly and leveraged his large social media following to amplify his narrative. However, his AI voices were seen as corny by some critics. Timing and Response: 8/10 Promotion and Publicity: 7/10 Total: 15/20</p>
<p>Kendrick: Carefully timed his responses, delivering rapid-fire tracks like “Euphoria” that resonated with critics and fans. Timing and Response: 10/10 Promotion and Publicity: 8/10 Total: 18/20</p>
<ol start="4" type="1">
<li><strong>Public Reception (15 points):</strong></li>
</ol>
<p>Drake: Despite loyal fan support, critical reception to “Push Ups” and “The Heart Part 6” was mixed, with many leaning towards Kendrick’s tracks. Fan Reactions: 4/5 Critical Acclaim: 3/5 Industry Influence: 3/5 Total: 10/15</p>
<p>Kendrick: His diss tracks were praised for their creativity, energy, and layered narratives. Critics generally agreed that he had the upper hand. Fan Reactions: 5/5 Critical Acclaim: 5/5 Industry Influence: 4/5 Total: 14/15</p>
<ol start="5" type="1">
<li><strong>Long-Term Career Impact (10 points):</strong></li>
</ol>
<p>Drake: The beef has intensified scrutiny around his credibility and put pressure on him to address Lamar’s allegations effectively. Reputation and Image: 3/5 Commercial Success: 4/5 Total: 7/10</p>
<p>Kendrick: Strengthened his reputation as a formidable lyricist and “boogeyman,” reinforcing his influence and commercial success. Reputation and Image: 5/5 Commercial Success: 5/5 Total: 10/10</p>
</section>
<section id="final-scores" class="level2">
<h2 class="anchored" data-anchor-id="final-scores">Final Scores:</h2>
</section>
<section id="drake-74100" class="level2">
<h2 class="anchored" data-anchor-id="drake-74100">Drake: 74/100</h2>
</section>
<section id="kendrick-lamar-95100" class="level2">
<h2 class="anchored" data-anchor-id="kendrick-lamar-95100">Kendrick Lamar: 95/100</h2>
<p>Conclusion: Based on this rubric analysis, Kendrick Lamar emerges as the clear winner of the beef due to his sharp lyrics, strategic timing, and greater public reception. Critics and fans have largely praised his responses for their creativity and personal impact, while Drake’s efforts, though strong, were perceived as less effective in this contest.</p>
</section>
<section id="guess-we-have-our-answer.-i-was-really-impressed-with-how-accurate-gpt-was-in-each-category-after-iterating-it-to-find-information." class="level2">
<h2 class="anchored" data-anchor-id="guess-we-have-our-answer.-i-was-really-impressed-with-how-accurate-gpt-was-in-each-category-after-iterating-it-to-find-information.">Guess we have our answer. I was really impressed with how accurate GPT was in each category after iterating it to find information.</h2>
<p><img src="beef.png" class="img-fluid"></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/manasnarula\.github\.io\/comm4190_S24_Using_LLMs_Blog\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>